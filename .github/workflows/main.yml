 name: CI
 
 on:
   push:
     branches: [ main, master, feature/github-actions-setup ]
   pull_request:
     branches: [ main, master, feature/github-actions-setup ]
 
 jobs:
   build:
     runs-on: ubuntu-latest
 
     services:
       postgres:
         image: postgres:latest
         env:
           POSTGRES_USER: ${{ secrets.DB_USER }}
           POSTGRES_PASSWORD: ${{ secrets.DB_PASSWORD }}
           POSTGRES_DB: ${{ secrets.DB_NAME }}
         ports:
           - 5432:5432
         options: >-
           --health-cmd pg_isready
           --health-interval 10s
           --health-timeout 5s
           --health-retries 5
 
     steps:
     - uses: actions/checkout@v3
 
     - name: Setup Node.js
       uses: actions/setup-node@v3
       with:
         node-version: '18.x'
         cache: 'npm'
 
     - name: Install dependencies
       run: npm ci
 
     - name: Run linter
       run: npm run lint
 
     - name: Build TypeScript
       run: npm run build
 
     - name: Run migrations
       run: npm run migrate:up
       env:
         DATABASE_URL: ${{ secrets.DATABASE_URL }}
         DB_HOST: ${{ secrets.DB_HOST }}
         DB_PORT: ${{ secrets.DB_PORT }}
         DB_USER: ${{ secrets.DB_USER }}
         DB_PASSWORD: ${{ secrets.DB_PASSWORD }}
         DB_NAME: ${{ secrets.DB_NAME }}
 
     - name: Run tests
       run: npm test
       env:
         DATABASE_URL: ${{ secrets.DATABASE_URL }}
         DB_HOST: ${{ secrets.DB_HOST }}
         DB_PORT: ${{ secrets.DB_PORT }}
         DB_USER: ${{ secrets.DB_USER }}
         DB_PASSWORD: ${{ secrets.DB_PASSWORD }}
         DB_NAME: ${{ secrets.DB_NAME }}